# Sistema de Gestión de Biblioteca Digital

[![Python Version](https://img.shields.io/badge/python-3.13-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Code Style](https://img.shields.io/badge/code%20style-PEP%208-orange.svg)](https://www.python.org/dev/peps/pep-0008/)

Sistema integral de gestión de biblioteca digital que demuestra la implementación de múltiples patrones de diseño de software con enfoque educativo y profesional.

## Características Principales

- ✅ **Gestión de 4 tipos de materiales** (Libro, Revista, eBook, Audiolibro)
- ✅ **Sistema de préstamos y reservas** con fechas de vencimiento
- ✅ **Cálculo automático de multas** según tipo de membresía
- ✅ **Sistema de notificaciones** en tiempo real
- ✅ **Gestión de usuarios** con diferentes niveles de membresía
- ✅ **Patrones de diseño**: Singleton, Factory, Observer, Strategy, Registry
- ✅ **PEP 8 compliance 100%** con type hints completos
- ✅ **Persistencia con Pickle** para usuarios y préstamos

## Patrones de Diseño Implementados

### 1. SINGLETON Pattern
**Ubicación**: `biblioteca_digital/servicios/usuarios/usuario_manager.py`

Implementa instancia única del gestor de usuarios con double-checked locking thread-safe.

```python
manager = UsuarioManager.get_instance()
```

### 2. FACTORY METHOD Pattern
**Ubicación**: `biblioteca_digital/patrones/factory/material_factory.py`

Encapsula creación de materiales sin exponer clases concretas.

```python
material = MaterialFactory.crear_material("Libro", "Don Quijote", "Miguel de Cervantes")
```

### 3. OBSERVER Pattern
**Ubicación**: `biblioteca_digital/patrones/observer/`

Sistema de notificaciones con Generics tipo-seguro.

```python
class NotificacionService(Observable[Notificacion]):
    # Notifica eventos a observadores
```

### 4. STRATEGY Pattern
**Ubicación**: `biblioteca_digital/patrones/strategy/`

Algoritmos intercambiables para cálculo de multas.

```python
# Membresía Premium: Sin multas
super().__init__(SinMultaStrategy())

# Membresía Básica: Multa estándar
super().__init__(MultaEstandarStrategy())
```

### 5. REGISTRY Pattern
**Ubicación**: `biblioteca_digital/servicios/materiales/material_service_registry.py`

Dispatch polimórfico para operaciones específicas por tipo.

```python
registry = MaterialServiceRegistry.get_instance()
dias = registry.obtener_dias_prestamo(material)
```

## Estructura del Proyecto

```
BibliotecaDigital/
├── biblioteca_digital/
│   ├── __init__.py
│   ├── constantes.py
│   ├── entidades/
│   │   ├── materiales/
│   │   │   ├── material.py (base abstracta)
│   │   │   ├── libro.py
│   │   │   ├── revista.py
│   │   │   ├── ebook.py
│   │   │   └── audiolibro.py
│   │   ├── usuarios/
│   │   │   ├── usuario.py
│   │   │   └── membresia.py
│   │   └── prestamos/
│   │       ├── prestamo.py
│   │       └── reserva.py
│   ├── servicios/
│   │   ├── materiales/
│   │   │   ├── material_service.py
│   │   │   ├── material_service_registry.py (SINGLETON + REGISTRY)
│   │   │   ├── libro_service.py
│   │   │   ├── revista_service.py
│   │   │   ├── ebook_service.py
│   │   │   └── audiolibro_service.py
│   │   ├── usuarios/
│   │   │   ├── usuario_manager.py (SINGLETON)
│   │   │   └── usuario_service.py
│   │   └── prestamos/
│   │       ├── prestamo_service.py
│   │       └── reserva_service.py
│   ├── patrones/
│   │   ├── factory/
│   │   │   └── material_factory.py (FACTORY METHOD)
│   │   ├── observer/
│   │   │   ├── observer.py (interfaz)
│   │   │   └── observable.py (OBSERVER)
│   │   ├── strategy/
│   │   │   ├── multa_strategy.py (interfaz)
│   │   │   └── impl/
│   │   │       ├── sin_multa_strategy.py (STRATEGY)
│   │   │       ├── multa_estandar_strategy.py (STRATEGY)
│   │   │       └── multa_reducida_strategy.py (STRATEGY)
│   │   └── singleton/
│   │       └── singleton_meta.py
│   ├── notificaciones/
│   │   ├── notificacion.py
│   │   └── notificacion_service.py (Observable)
│   └── excepciones/
│       ├── biblioteca_exception.py (base)
│       ├── material_no_disponible_exception.py
│       ├── usuario_no_encontrado_exception.py
│       └── persistencia_exception.py
├── data/
│   └── [archivos .dat de usuarios]
└── main.py (ejemplo de integración)
```

## Instalación

### Requisitos
- Python 3.13 o superior
- No requiere dependencias externas (solo biblioteca estándar)

### Pasos

1. Clonar o descargar el proyecto

2. Verificar versión de Python:
```bash
python --version
```

3. Ejecutar el sistema:
```bash
python main.py
```

## Uso del Sistema

### Ejemplo Básico

```python
from biblioteca_digital.servicios.usuarios.usuario_manager import UsuarioManager
from biblioteca_digital.servicios.materiales.material_service_registry import MaterialServiceRegistry
from biblioteca_digital.patrones.factory.material_factory import MaterialFactory

# Obtener gestor de usuarios (Singleton)
usuario_manager = UsuarioManager.get_instance()

# Registrar usuario
usuario = usuario_manager.registrar_usuario(
    dni=12345678,
    nombre="Juan Perez",
    email="juan@email.com",
    tipo_membresia="Premium"
)

# Crear material (Factory)
libro = MaterialFactory.crear_material(
    tipo="Libro",
    titulo="Cien años de soledad",
    autor="Gabriel García Márquez"
)

# Prestar material
prestamo_service = PrestamoService()
prestamo = prestamo_service.realizar_prestamo(usuario, libro)
```

### Sistema de Notificaciones

```python
from biblioteca_digital.notificaciones.notificacion_service import NotificacionService
from biblioteca_digital.patrones.observer.observer import Observer

# Crear servicio de notificaciones (Observable)
notif_service = NotificacionService()

# Crear observador personalizado
class EmailNotifier(Observer):
    def actualizar(self, notificacion):
        print(f"Enviando email: {notificacion.mensaje}")

# Suscribir observador
email_notifier = EmailNotifier()
notif_service.agregar_observador(email_notifier)

# Enviar notificación (notifica a todos los observadores)
notif_service.notificar_devolucion_proxima(usuario, prestamo)
```

### Cálculo de Multas (Strategy)

```python
# El cálculo de multas se hace automáticamente según membresía
usuario_basico = usuario_manager.registrar_usuario(
    dni=87654321,
    nombre="Maria Lopez",
    email="maria@email.com",
    tipo_membresia="Basica"
)

# Usuario básico: 2.00 por día de retraso
multa = usuario_basico.calcular_multa(dias_retraso=5)  # 10.00

usuario_premium = usuario_manager.buscar_usuario(12345678)
# Usuario premium: Sin multas
multa = usuario_premium.calcular_multa(dias_retraso=5)  # 0.00
```

### Persistencia

```python
from biblioteca_digital.servicios.usuarios.usuario_service import UsuarioService

usuario_service = UsuarioService()

# Guardar usuario en disco
usuario_service.guardar_usuario(usuario)  # data/Juan Perez.dat

# Cargar usuario desde disco
usuario_cargado = usuario_service.cargar_usuario("Juan Perez")
```

## Testing y Validación

El archivo `main.py` contiene un test de integración completo que valida:

- ✅ Patrón Singleton - Instancia única del UsuarioManager
- ✅ Patrón Factory - Creación de 4 tipos de materiales
- ✅ Patrón Observer - Sistema de notificaciones
- ✅ Patrón Strategy - Cálculo de multas diferenciado
- ✅ Patrón Registry - Dispatch polimórfico
- ✅ Gestión de préstamos y reservas
- ✅ Cálculo automático de multas
- ✅ Sistema de notificaciones
- ✅ Persistencia y recuperación

### Ejecutar Tests

```bash
python main.py
```

**Criterios de éxito**:
- No errores de importación
- No excepciones no controladas
- Mensaje final: `SISTEMA DE BIBLIOTECA DIGITAL - PRUEBA COMPLETADA EXITOSAMENTE`
- Archivo creado: `data/Juan Perez.dat`

## Convenciones de Código

### PEP 8 Compliance

- **Nombres de variables**: `snake_case`
- **Nombres de clases**: `PascalCase`
- **Constantes**: `UPPER_SNAKE_CASE` en `constantes.py`
- **Privados**: Prefijo `_nombre`

### Docstrings (Google Style)

```python
def metodo(self, parametro: str) -> int:
    """
    Descripción breve del método.

    Args:
        parametro: Descripción del parámetro

    Returns:
        Descripción del valor de retorno

    Raises:
        ValueError: Cuando ocurre validación
    """
```

### Type Hints

```python
from typing import TYPE_CHECKING, List, Optional

if TYPE_CHECKING:
    from modulo import Clase  # Evita imports circulares

def metodo(self, lista: List[int]) -> Optional[str]:
    pass
```

## Arquitectura

El sistema sigue principios SOLID:

- **Single Responsibility**: Cada clase tiene una única razón para cambiar
- **Open/Closed**: Abierto a extensión, cerrado a modificación
- **Liskov Substitution**: Subtipos intercambiables
- **Interface Segregation**: Interfaces específicas
- **Dependency Inversion**: Dependencias de abstracciones

### Separación de Capas

```
┌──────────────────────────────────┐
│      PRESENTACIÓN (main.py)      │
└──────────────────────────────────┘
                ↓
┌──────────────────────────────────┐
│  SERVICIOS DE NEGOCIO (servicios/)│
└──────────────────────────────────┘
                ↓
┌──────────────────────────────────┐
│      ENTIDADES (entidades/)      │
└──────────────────────────────────┘
                ↓
┌──────────────────────────────────┐
│  PATRONES / UTILIDADES (patrones/)│
└──────────────────────────────────┘
```

## Contribución

Para agregar un nuevo tipo de material, seguir estos pasos:

1. Definir constantes en `constantes.py`
2. Crear entidad en `entidades/materiales/`
3. Crear servicio en `servicios/materiales/`
4. Registrar en `MaterialServiceRegistry`
5. Agregar a `MaterialFactory`

## Notas Importantes

### Compatibilidad con Windows

- **NO usar emojis** en print (problema de encoding)
- **NO usar caracteres Unicode especiales** en consola
- Usar solo ASCII estándar: `[OK]`, `[!]`, `[INFO]`

### Limitaciones Conocidas

1. Pickle NO es seguro para datos no confiables
2. Sistema single-process (no distribuido)
3. Sin base de datos relacional
4. Sin interfaz gráfica (solo CLI)

**Este es un proyecto EDUCATIVO** enfocado en patrones de diseño, NO en producción real.

## Licencia

Este proyecto es de código abierto y está disponible bajo la licencia MIT.

---

**Última actualización**: Noviembre 2025  
**Versión del sistema**: 1.0.0  
**Python requerido**: 3.13+